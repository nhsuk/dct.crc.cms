steps:
- task: Docker@2
  inputs:
    containerRegistry: 'nhsuk acr-dct.campaign-resource-centre-v3'
    command: 'login'
- script: |
    docker-compose -f ./docker-compose-test-coverage.yml up --build --force-recreate --exit-code-from campaignresourcecentre-test-coverage
  displayName: 'Run Coverage Test'
  enabled: true
- task: PublishTestResults@2
  displayName: "Publish Test Results"
  inputs:
    testResultsFiles: "**/testresults.xml"
  condition: succeededOrFailed()
- task: PublishCodeCoverageResults@1
  displayName: "Publish code coverage results"
  inputs:
    codeCoverageTool: "Cobertura"
    summaryFileLocation: "./docker/coverage.xml"
    failIfCoverageEmpty: true
  condition: succeededOrFailed()

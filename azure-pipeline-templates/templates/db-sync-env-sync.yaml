steps:
- template: ./db-sync-download-dump.yaml
  parameters:
    azureVaultSubscription: ${{ parameters.azureVaultSubscription }}
    azureStorageSubscription: ${{ parameters.azureStorageSubscription}}
    VaultId: ${{ parameters.VaultId }}
    artifactPrefix: "${{ parameters.environment }}_users"
    usersOnly: True

- template: ./db-sync-restore-db.yaml
  parameters:
    azureVaultSubscription: ${{ parameters.azureVaultSubscription }}
    azureStorageSubscription: ${{ parameters.azureStorageSubscription}}
    VaultId: ${{ parameters.VaultId }}
    DBName: ${{ parameters.DBName }}
    Server: ${{ parameters.Server }}
    ResourceGroup: ${{ parameters.ResourceGroup }}
    artifactPrefix: "prod"

- template: ./db-sync-restore-users.yaml
  parameters:
    azureVaultSubscription: ${{ parameters.azureVaultSubscription }}
    azureStorageSubscription: ${{ parameters.azureStorageSubscription}}
    VaultId: ${{ parameters.VaultId }}
    artifactPrefix: "${{ parameters.environment }}_users"
    
- template: ./db-sync-download-dump.yaml
  parameters:
    azureVaultSubscription: ${{ parameters.azureVaultSubscription }}
    azureStorageSubscription: ${{ parameters.azureStorageSubscription}}
    VaultId: ${{ parameters.VaultId }}
    artifactPrefix: ${{ parameters.environment }}
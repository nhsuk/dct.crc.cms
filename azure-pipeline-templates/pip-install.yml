steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.12'
    displayName: Use Python 3.12
  - bash: |
      pipDir=$(pip cache dir)
      echo $pipDir
      echo "##vso[task.setvariable variable=pipDirectory;]$pipDir"
    displayName: Get pip location
  - task: Cache@2
    displayName: Cache pip location
    inputs:
      key: |
        pip | "$(Agent.OS)" | CampaignsCMS | $(Build.SourcesDirectory)/requirements.txt
      restoreKeys: |
        pip | "$(Agent.OS)" | CampaignsCMS | $(Build.SourcesDirectory)/requirements.txt
      path: $(pipDirectory)
      cacheHitVar: PIP_CACHE_RESTORED
  - task: Cache@2
    displayName: Cache pip test location
    inputs:
      key: |
        pip | "$(Agent.OS)" | CampaignsCMS | $(Build.SourcesDirectory)/test-requirements.txt
      restoreKeys: |
        pip | "$(Agent.OS)" | CampaignsCMS | $(Build.SourcesDirectory)/test-requirements.txt
      path: $(pipDirectory)
      cacheHitVar: PIP_CACHE_RESTORED
  - script: |
      pip install --upgrade pip --cache-dir $(pipDirectory)
    displayName: Upgrade pip
  - script: |
      pip install -r requirements.txt --cache-dir $(pipDirectory)
    displayName: Run pip install
  - script: |
      pip install -r test-requirements.txt --cache-dir $(pipDirectory)
    displayName: Run pip test install
{% extends "wagtailadmin/base.html" %}
{% load wagtailadmin_tags static %}

{% block titletag %}Tag Management Results{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'tag_management/css/bulk_manage_tags.css' %}">
{% endblock %}

{% block content %}
    {% include "wagtailadmin/shared/header.html" with title="Tag Management Results" icon="success" %}

    <div class="nice-padding tag-management-results">
        {% block operation_summary %}{% endblock %}

        {% if num_failed > 0 %}
            <div class="help-block help-warning">
                <svg class="icon" aria-hidden="true"><use href="#icon-warning"></use></svg>
                {{ num_failed }} page{{ num_failed|pluralize }} failed to update
            </div>
        {% endif %}

        {% if num_modified > 0 %}
            <div class="help-block help-info">
                <svg class="icon" aria-hidden="true"><use href="#icon-success"></use></svg>
                {{ num_modified }} page{{ num_modified|pluralize:" was,s were" }} successfully updated
            </div>
        {% endif %}

        <h2>Changes Made</h2>
        
        {% if change_details %}
            <table class="listing">
                <colgroup>
                    <col>
                    <col>
                    <col>
                </colgroup>
                <thead>
                    <tr>
                        <th>Page</th>
                        {% block table_headers %}{% endblock %}
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for change in change_details %}
                        <tr>
                            <td>
                                <a href="{{ change.edit_url }}" target="_blank" rel="noreferrer">
                                    {{ change.page_title }}
                                </a>
                            </td>
                            {% block table_row %}{% endblock %}
                            <td>
                                {% if change.error %}
                                    <span class="status-tag warning">Failed</span>
                                    <br><small>{{ change.error }}</small>
                                {% elif change.had_changes %}
                                    <span class="status-tag primary">Updated</span>
                                {% else %}
                                    <span class="status-tag">No changes made</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No changes were made.</p>
        {% endif %}

        <div class="button-wrapper">
            <a href="{{ next_url }}" class="button">Back to Pages</a>
        </div>
    </div>
{% endblock %}